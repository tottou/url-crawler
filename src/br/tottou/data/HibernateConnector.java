package br.tottou.data;

import org.hibernate.HibernateException;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.cfg.Configuration;

public class HibernateConnector {

	 private static HibernateConnector me;
	    private Configuration cfg;
	    private SessionFactory sessionFactory;
	 
	    @SuppressWarnings("deprecation")
		private HibernateConnector() throws HibernateException {
	 
	        // build the config
	        cfg = new Configuration().configure();
	         
	        sessionFactory = cfg.buildSessionFactory();
	    }
	 
	    public static synchronized HibernateConnector getInstance() throws HibernateException {
	        if (me == null) {
	            me = new HibernateConnector();
	        }
	 
	        return me;
	    }
	 
	    public Session getSession() throws HibernateException {
	        Session session = sessionFactory.openSession();
	        if (!session.isConnected()) {
	            this.reconnect();
	        }
	        return session;
	    }
	 
	    @SuppressWarnings("deprecation")
		private void reconnect() throws HibernateException {
	        this.sessionFactory = cfg.buildSessionFactory();
	    }
}
